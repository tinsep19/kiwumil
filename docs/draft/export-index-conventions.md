# Export インデックスの共通ルール

## 1. Requirements Summary

- **Functional Requirements**
  - src 以下の各ディレクトリは `index.ts` でディレクトリ内のエクスポートを集約し、他ディレクトリから使える型/関数/コンポーネントを再公開する。
  - ディレクトリ内の個別ファイルは原則として同じディレクトリの `index.ts` を経由したエクスポートのみを使い、深い相互依存や散在する直接インポートを避ける。
  - 外部ディレクトリからの利用は常にフォルダ単位（`@/src/some/dir` など）でインポートし、内部ファイルパスを直接参照しない。

- **Non-Functional Requirements**
  - 可読性を維持するため、すべての公開 API がディレクトリの入口 (`index.ts`) に集約されていること。
  - 型チェックや移植性の観点から、ディレクトリ構造の変更時に追跡しやすい export 設計であること。

- **Constraints**
  - `index.ts` ではディレクトリ内のファイルから再エクスポートするだけで、ロジックを含めない。
  - `src/foo/bar.ts` などのファイルを外部から直接 `import` することは禁止し、`src/foo/index.ts` を介す。
  - `index.ts` 自体が依存解決の起点になりすぎないよう、ディレクトリ間での循環を生まない依存関係を維持する（例：`src/feature` が `src/shared` を参照するが逆方向にしない）。

- **Dependencies**
  - 現行のエイリアス設定（`tsconfig.json` の `paths`）に従い、ディレクトリを指すインポートパスを整備する必要あり。
  - 将来的に ESLint や TypeScript の `barrel` ルールで自動チェックする余地がある。

- **Open Questions**
  - 新たに ESLint ルールや TypeScript プラグインで `index` 経由の制約を自動検出すべきか？
  - テストディレクトリも同様に扱うか、src 配下だけで運用するか？

## 2. Use Cases

- ディレクトリ内の機能開発者は `index.ts` に再エクスポートを書き、他のディレクトリは `import { Foo } from "@/src/dir"` のように取得して機能を組み合わせる。

## 3. Data / Domain Model Candidates

- **Entities**
  - ディレクトリ（モジュール境界）のエントリポイント
  - 再エクスポートされる型・関数

- **Attributes**
  - `index.ts` に書かれた `export * from "./foo"` や `export { Foo } from "./foo"` の一覧

- **Relationships**
  - 外部ディレクトリはインポート時に `index.ts` で再エクスポートされたエンティティを参照する（直接依存を持たない）。
  - 循環参照の兆候を明確にするため、再エクスポートリストは単一方向の依存パターンになるよう整理する（横断的な `index` 同士の import を避ける）。

## 4. Engineering Notes

- **必要なモジュール**
  - 各ディレクトリの `index.ts` に対して必ずエクスポートリストを整備。
  - 複数のエクスポートをまとめる際は `export type { ... }` などで区別し、型と実体が混ざらないようにする。
  - 循環が発生しそうな構造（A→B→A）では、共通型やインターフェースだけを `types/` などの独立したファイルに切り出し、値やインスタンスは分離する。
  - 値の依存が交差する場面では `index.ts` に `export type { ... }` を使って型のみを再公開し、初期化ロジックは遅延実行する `createX` などに委ねる。

- **既存コードへの変更**
  - 既存のディレクトリで内部ファイルを直接 import している箇所を `index.ts` へ置き換える。
  - `tsconfig` エイリアスが未整備であれば、`paths` にディレクトリ単位のパスを追加。

- **API 仕様**
  - モジュールの公開 API は `src/dir/index.ts` の冒頭に記載し、内部ファイルは `/dir/internal.ts` などでのみ参照。

- **UI/UX 振る舞い**
  - （該当なし）

## 5. Tasks (ToDo)

- [ ] 各 src ディレクトリに index.ts を整備し、再エクスポートを整理する。
- [ ] 外部モジュールで内部ファイルを直接参照していないかリファクタリングする。
- [ ] ディレクトリ間の依存が一方向になるようグラフを整理し、循環を防止する。
- [ ] `tsconfig.json` や ESLint ルールでディレクトリ単位インポートを強制できるよう検討する。
