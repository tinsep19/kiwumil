# kiwi ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¸ã®å¢ƒç•Œã®æ˜ç¢ºåŒ–

## ç›®çš„
- Layout ç³»ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¢ƒç•Œã‚’æ˜ç¢ºã«ã—ã€@lume/kiwiï¼ˆä»¥é™ kiwiï¼‰ã«ä¾å­˜ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®é«˜ãƒ¬ãƒ™ãƒ« API ã‚’åˆ†é›¢ã™ã‚‹ã€‚
- solver ã®æ‰€æœ‰å ´æ‰€ã‚’çµ±ä¸€ã—ã¦ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’ç®¡ç†ã—ã‚„ã™ãã™ã‚‹ï¼ˆLayoutContext ã«ç§»å‹•ï¼‰ã€‚
- å¯èª­æ€§ã¨å†åˆ©ç”¨æ€§ã‚’å‘ä¸Šã•ã›ã€å°†æ¥çš„ãªãƒ†ã‚¹ãƒˆãƒ»å·®ã—æ›¿ãˆï¼ˆmock / alternate solverï¼‰ã®å°å…¥ã‚’å®¹æ˜“ã«ã™ã‚‹ã€‚
- **å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è²¬å‹™ã‚’æ˜ç¢ºã«åˆ†é›¢ã—ã€LayoutSolver ã§ã§ãã‚‹ç¯„å›²ã®ã“ã¨ã‚’å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç‹¬ç«‹ã—ã¦æ‰±ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚**

## èƒŒæ™¯ / å•é¡Œæ„è­˜
- ç¾çŠ¶ã§ã¯ kiwi.Solver ãŒ src/layout/layout_variables.ts ã«ç½®ã‹ã‚Œã¦ãŠã‚Šã€solver ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã¨ solve ã®å‘¼ã³å‡ºã—ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒæ•£ã‚‰ã°ã£ã¦ã„ã‚‹ã€‚
- å¤‰æ•°å®šç¾©ï¼ˆLayoutVariablesï¼‰ã¨åˆ¶ç´„ç®¡ç†ï¼ˆLayoutConstraints / LayoutContextï¼‰ãŒ solver ã®æ‰€æœ‰æ¨©ã‚’æ˜ç¢ºã«å…±æœ‰ã§ãã¦ãŠã‚‰ãšã€è¤‡æ•°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚„ãƒãƒƒãƒæ›´æ–°ã®é‹ç”¨æ™‚ã«ç®¡ç†ãŒé›£ã—ã„ã€‚
- kiwi ã¸ä¾å­˜ã™ã‚‹å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆLayoutExpression -> kiwi.Expressionï¼‰ã‚„ solver æ“ä½œãŒè¤‡æ•°ç®‡æ‰€ã«åˆ†æ•£ã—ã¦ã„ã‚‹ãŸã‚ã€å¤‰æ›´æ™‚ã®å½±éŸ¿ç¯„å›²ãŒåºƒã„ã€‚
- **LayoutVariables ã®è²¬å‹™ãŒè¾¼ã¿å…¥ã£ã¦ãŠã‚Šã€å¤‰æ•°ç”Ÿæˆä»¥å¤–ã®æ©Ÿèƒ½ï¼ˆexpression()ã€addConstraint()ï¼‰ã‚‚æŒã£ã¦ã„ã‚‹ã€‚**
- **LayoutConstraints ãŒ LayoutVariables ã‚’çµŒç”±ã—ã¦ solver ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãŠã‚Šã€é–“æ¥çš„ãªä¾å­˜é–¢ä¿‚ãŒè²¬å‹™ã‚’æ›–æ˜§ã«ã—ã¦ã„ã‚‹ã€‚**

## æ”¹å–„ã®æ–¹é‡
- kiwi ä¾å­˜ã®å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¨ã‚½ãƒ«ãƒãƒ¼ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ src/layout/kiwi ã«é›†ç´„ã™ã‚‹ï¼ˆtoKiwiExpressionã€LayoutSolver ç­‰ï¼‰ã€‚
- LayoutContext ãŒ Solverï¼ˆLayoutSolverï¼‰ã‚’æ‰€æœ‰ã—ã€solveï¼ˆupdateVariablesï¼‰ã®ãƒˆãƒªã‚¬ã¨ãƒãƒƒãƒç®¡ç†ã‚’æ‹…ã†ã€‚
- **LayoutVariables ã‚’ç°¡ç´ åŒ–ã—ã€LayoutVar ãŠã‚ˆã³ LayoutBound ã®ç”Ÿæˆã¨å€¤ã®å–å¾—ã®ã¿ã«å°‚å¿µã•ã›ã‚‹ã€‚**
- **expression() ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ LayoutSolver ã«ç§»å‹•ã—ã€kiwi ãƒ©ãƒƒãƒ‘ãƒ¼ã¨ã—ã¦ã®è²¬å‹™ã‚’æ˜ç¢ºã«ã™ã‚‹ã€‚**
- **LayoutConstraints ãŒ solver ã‚’ç›´æ¥å—ã‘å–ã‚Šã€vars ã¨ solver ã‚’ç‹¬ç«‹ã—ã¦ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚**
- **vars ã¨ constraints ã®é–¢ä¿‚ã‚’åˆ‡ã‚Šé›¢ã—ã€ä¸¡è€…ã¨ã‚‚ LayoutSolver ã‚’é€šã˜ã¦é€£æºã™ã‚‹è¨­è¨ˆã«ã™ã‚‹ã€‚**

## ç§»è¡Œæ‰‹é †ï¼ˆå®‰å…¨ã«é€²ã‚ã‚‹é †ç•ªï¼‰
1. âœ… kiwi ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ä½œæˆï¼ˆå®Œäº†ï¼‰
   - src/layout/kiwi/index.ts ã‚’è¿½åŠ ã—ã€toKiwiExpression ã¨ LayoutSolverï¼ˆkiwi.Solver ã®ãƒ©ãƒƒãƒ‘ï¼‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚
   - Operator / Strength ã®å†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚‚è¡Œã„ã€kiwi ä¾å­˜ã‚’ä¸€ç®‡æ‰€ã«é›†ç´„ã™ã‚‹ã€‚

2. âœ… å‹ã®åˆ‡ã‚Šå‡ºã—ï¼ˆå®Œäº†ï¼‰
   - LayoutVar / LayoutExpression ç­‰ã®å‹ãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ»åˆ¤å®šé–¢æ•°ã‚’ src/layout/layout_types.ts ã«ã¾ã¨ã‚ã‚‹ã€‚
   - å¾ªç’°ä¾å­˜ã‚’é¿ã‘ã¤ã¤ã€å‹ã®ã¿ã‚’å‚ç…§ã§ãã‚‹çŠ¶æ…‹ã«ã™ã‚‹ã€‚

3. âœ… LayoutVariables ã‚’ä¾å­˜æ³¨å…¥å¯¾å¿œã«ã™ã‚‹ï¼ˆå®Œäº†ï¼‰
   - LayoutVariables ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ (solver?: LayoutSolver) ã«å¤‰æ›´ã—ã€å¼•æ•°ãŒãªã‘ã‚Œã°å†…éƒ¨ã§æ–°è¦ä½œæˆã™ã‚‹å®Ÿè£…ã«ã™ã‚‹ã€‚
   - æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¯å½“é¢å½±éŸ¿ã‚’å—ã‘ãªã„ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ™å‹•ã§å‹•ä½œï¼‰ã€‚

4. âœ… LayoutContext ã« Solver ã‚’ç§»å‹•ï¼ˆå®Œäº†ï¼‰
   - LayoutContext ãŒ LayoutSolver ã‚’ new ã—ã¦ä¿æŒã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã€‚
   - Context ãŒ solver ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’ç®¡ç†ã—ã€solve ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åˆ¶å¾¡ã™ã‚‹ã€‚

5. âœ… LayoutConstraints ã®è²¬å‹™æ•´ç†ï¼ˆè©•ä¾¡å®Œäº†ï¼‰
   - ç§»è¡Œæ‰‹é † 1-4 ã«ã‚ˆã‚Šã€åŸºæœ¬çš„ãªè²¬å‹™åˆ†é›¢ã¯é”æˆã€‚

6. âœ… å‘¼ã³å‡ºã—å…ƒã®æ›´æ–°ï¼ˆè©•ä¾¡å®Œäº†ï¼‰
   - solve() ã¯æ—¢ã« Context çµŒç”±ã§å®Ÿè¡Œã•ã‚Œã‚‹è¨­è¨ˆã«ç§»è¡Œæ¸ˆã¿ã€‚

7. âœ… **è²¬å‹™ã®æœ€çµ‚èª¿æ•´ï¼ˆå®Œäº†ï¼‰**
   - **LayoutSolver ã« expression() ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ **
   - **LayoutVariables ã‹ã‚‰ expression() ã¨ addConstraint() ã‚’å‰Šé™¤ã—ã€å¤‰æ•°ç”Ÿæˆã®ã¿ã«å°‚å¿µ**
   - **LayoutConstraints ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ (vars, solver, theme, resolveSymbol) ã«å¤‰æ›´**
   - **LayoutConstraints ãŒ vars ã¨ solver ã‚’ç‹¬ç«‹ã—ã¦ä½¿ç”¨ã™ã‚‹è¨­è¨ˆã«å¤‰æ›´**
   - **LayoutContext ã‚’ vars, solver, constraints ã®çµ±æ‹¬å½¹ã¨ã—ã¦æ˜ç¢ºåŒ–**

8. **ğŸ”„ LayoutBound ã® interface åŒ–ï¼ˆå®Ÿæ–½ä¸­ï¼‰**
   - **LayoutBound ã‚’ class ã‹ã‚‰ interface ã«å¤‰æ›´**
   - **LayoutVariables ã« createBound() factory ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ **
   - **computed properties (right, bottom, centerX, centerY) ã®åˆ¶ç´„ç”Ÿæˆã‚’ LayoutVariables å†…ã«é›†ç´„**
   - **LayoutBound ãŒ vars ã¨ solver ã¸ã®ä¾å­˜ã‚’æŒãŸãªã„ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹é€ ã«**

9. å‰¯æ¬¡ä½œæ¥­ã¨æ¤œè¨¼
   - tscï¼ˆå‹ãƒã‚§ãƒƒã‚¯ï¼‰ãŠã‚ˆã³æ—¢å­˜ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦å‹•ä½œç¢ºèªã€‚
   - solve ã®å‘¼ã³å‡ºã—ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆãƒãƒƒãƒåŒ–ï¼‰ã«ã‚ˆã‚‹å‹•ä½œã‚„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å›å¸°ãŒãªã„ã‹ç°¡æ˜“ãƒ™ãƒ³ãƒã‚’å®Ÿæ–½ã€‚
   - å¤‰æ›´ç‚¹ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆREADME ã‚„é–‹ç™ºè€…å‘ã‘ãƒ¡ãƒ¢ï¼‰ã«è¿½è¨˜ã€‚

## ãƒªã‚¹ã‚¯ã¨è»½æ¸›ç­–
- å¾ªç’°ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼šå‹ï¼ˆlayout_typesï¼‰ã¨ kiwi ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’åˆ†é›¢ã™ã‚‹ã“ã¨ã§å›é¿ã™ã‚‹ã€‚
- å‹•ä½œå¤‰æ›´ï¼ˆsolve ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰ï¼šContext å´ã§ãƒãƒƒãƒã®åˆ¶å¾¡ã‚’è¡Œã†ãŸã‚ã€solve ã®å‘¼ã³å‡ºã—ç®‡æ‰€ãŒå¢—ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚æ—¢å­˜ã® solve å‘¼ã³å‡ºã—ã‚’ä¸€ç®‡æ‰€ã«é›†ç´„ã™ã‚‹ã‹ã€äº’æ› API ã‚’æ®‹ã—ã¦æ®µéšçš„ç§»è¡Œã™ã‚‹ã€‚
- API ã®äº’æ›æ€§ï¼šã¾ãšã¯ LayoutVariables ãŒå†…éƒ¨ã§æ–°è¦ LayoutSolver ã‚’ä½œã‚‹æ—¢å­˜æŒ™å‹•ã‚’æ®‹ã—ã€æ®µéšçš„ã« Context æ³¨å…¥ã¸åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚

## å®Ÿæ–½äºˆå®šã®å·®åˆ†ï¼ˆæ¦‚ç•¥ï¼‰
- âœ… è¿½åŠ : src/layout/kiwi/index.tsï¼ˆtoKiwiExpressionã€LayoutSolverï¼‰
- âœ… è¿½åŠ : src/layout/layout_types.tsï¼ˆå‹å®šç¾©ã¨ãƒ–ãƒ©ãƒ³ãƒ‰ã‚·ãƒ³ãƒœãƒ«ï¼‰
- âœ… å¤‰æ›´: src/layout/kiwi/index.tsï¼ˆLayoutSolver ã« expression() ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ï¼‰
- âœ… å¤‰æ›´: src/layout/layout_variables.tsï¼ˆexpression() ã¨ addConstraint() ã‚’å‰Šé™¤ã€å¤‰æ•°ç”Ÿæˆã®ã¿ã«å°‚å¿µï¼‰
- âœ… å¤‰æ›´: src/layout/layout_constraints.tsï¼ˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã« solver ã‚’è¿½åŠ ã€vars ã¨ solver ã‚’ç‹¬ç«‹ã—ã¦ä½¿ç”¨ï¼‰
- âœ… å¤‰æ›´: src/layout/layout_context.tsï¼ˆsolver ã‚’ constraints ã«ã‚‚æ³¨å…¥ï¼‰
- ğŸ”„ å¤‰æ›´: src/layout/layout_bound.tsï¼ˆclass ã‹ã‚‰ interface ã«å¤‰æ›´ï¼‰
- ğŸ”„ å¤‰æ›´: src/layout/layout_variables.tsï¼ˆcreateBound() factory ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã€åˆ¶ç´„ç”Ÿæˆã‚’å†…åŒ…ï¼‰

## æœ€çµ‚ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
LayoutContext (ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)
  â”œâ”€â”€ solver: LayoutSolverï¼ˆæ‰€æœ‰ã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ï¼‰
  â”œâ”€â”€ vars: LayoutVariablesï¼ˆsolver æ³¨å…¥ï¼‰
  â””â”€â”€ constraints: LayoutConstraintsï¼ˆvars ã¨ solver ã‚’ä¸¡æ–¹æ³¨å…¥ï¼‰

LayoutVariablesï¼ˆå¤‰æ•°ã¨ãƒã‚¦ãƒ³ãƒ‰ã®ç”Ÿæˆãƒ»ç®¡ç†ï¼‰
  - createVar(): LayoutVar ã®ç”Ÿæˆ
  - createBound(): LayoutBound ã®ç”Ÿæˆï¼ˆfactory ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
  - valueOf(): å¤‰æ•°å€¤ã®å–å¾—
  â€» expression() ã¨ addConstraint() ã¯å‰Šé™¤
  â€» LayoutBound ã¯ interface ã¨ã—ã¦å®šç¾©ã—ã€factory ã§ç”Ÿæˆ

LayoutSolverï¼ˆkiwi ãƒ©ãƒƒãƒ‘ãƒ¼ï¼‰
  - expression(): å¼ã®ä½œæˆ â† LayoutVariables ã‹ã‚‰ç§»å‹•
  - addConstraint(): åˆ¶ç´„ã®è¿½åŠ 
  - removeConstraint(): åˆ¶ç´„ã®å‰Šé™¤
  - updateVariables(): solve ã®å®Ÿè¡Œ
  - ãã®ä»– kiwi ã®æ©Ÿèƒ½ãƒ©ãƒƒãƒ‘ãƒ¼

LayoutConstraintsï¼ˆåˆ¶ç´„ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ï¼‰
  - ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿: (vars, solver, theme, resolveSymbol)
  - vars: å¤‰æ•°ç”Ÿæˆã®ã¿ã«ä½¿ç”¨
  - solver: å¼ä½œæˆã¨åˆ¶ç´„è¿½åŠ ã«ä½¿ç”¨
  - arrangeHorizontal() ãªã©ã®åˆ¶ç´„ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
```

**ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**:
- vars ã¨ constraints ã¯ç‹¬ç«‹ï¼ˆç›´æ¥ã®ä¾å­˜ãªã—ï¼‰
- ä¸¡æ–¹ã¨ã‚‚ solver ã‚’é€šã˜ã¦é€£æº
- Context ãŒ vars, solver, constraints ã‚’çµ±æ‹¬

## å®Œäº†çŠ¶æ³
- âœ… ç§»è¡Œæ‰‹é † 1-7 å®Œäº†
- âœ… ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆé€šé
- âœ… å¾Œæ–¹äº’æ›æ€§ç¶­æŒ

æœ€çµ‚ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
```
LayoutContext
  â”œâ”€â”€ solver: LayoutSolverï¼ˆæ‰€æœ‰ï¼‰
  â”œâ”€â”€ vars: LayoutVariablesï¼ˆsolver æ³¨å…¥æ¸ˆã¿ï¼‰
  â””â”€â”€ constraints: LayoutConstraintsï¼ˆvars ã¨ solver ã‚’ä¸¡æ–¹æ³¨å…¥ï¼‰

ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼:
  - vars ã¨ constraints ã¯ç‹¬ç«‹
  - ä¸¡æ–¹ã¨ã‚‚ solver ã‚’é€šã˜ã¦é€£æº
  - Context ãŒå…¨ä½“ã‚’çµ±æ‹¬
```

æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- ã“ã® PR ã§ã¯è¨ˆç”»ã¨å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸã€‚
- docs/draft/kiwi-boundary-refactor.md ã¯ docs/design/ ã«ç§»å‹•å¯èƒ½ã§ã™ã€‚
- ã•ã‚‰ãªã‚‹æœ€é©åŒ–ã¯åˆ¥ PR ã§å®Ÿæ–½ã—ã¾ã™ã€‚
